<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>api.verification_library &mdash; ConStrain 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #B87333" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ConStrain
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../Code%20Documentation.html">Code Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #B87333" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ConStrain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">api.verification_library</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for api.verification_library</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">verification_library.py</span>
<span class="sd">====================================</span>
<span class="sd">Verification Library API</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">library_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;library_item_id&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
    <span class="s2">&quot;description_brief&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;description_detail&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;description_index&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="s2">&quot;description_datapoints&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="s2">&quot;description_assertions&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="s2">&quot;description_verification_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;assertions_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="VerificationLibrary"><a class="viewcode-back" href="../../Code%20Documentation.html#api.verification_library.VerificationLibrary">[docs]</a><span class="k">class</span> <span class="nc">VerificationLibrary</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate a verification library class object and load specified library items as `self.lib_items`.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib_path (str, optional): path to the verification library file or folder. If the path ends with `*.json`, then library items defined in the json file are loaded. If the path points to a directory, then library items in all jsons in this directory and its subdirectories are loaded. Library item need to have unique name defined in the json files and python files. Defaults to None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib_items_json_path</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib_items_python_path</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># check argument</span>
        <span class="k">if</span> <span class="n">lib_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;&#39;lib_path&#39; was not provided when instantiating the Verificationlibrary class object!&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;lib_path needs to be str of library file or foler path. It cannot be a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">lib_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># load lib</span>
        <span class="n">lib_path</span> <span class="o">=</span> <span class="n">lib_path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">lib_files_json_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">lib_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">lib_items_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">lib_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lib_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                <span class="n">lib_path</span> <span class="o">=</span> <span class="n">lib_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">lib_items_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lib_path</span><span class="si">}</span><span class="s2">**/*.json&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lib_items_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no json file in </span><span class="si">{</span><span class="n">lib_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">lib_items_file_path</span> <span class="ow">in</span> <span class="n">lib_items_files</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lib_items_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">lib_items_file</span><span class="p">:</span>
                <span class="n">lib_files_json_dict</span><span class="p">[</span><span class="n">lib_items_file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">lib_items_file</span><span class="p">)</span>

        <span class="c1"># store items</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lib_files_json_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">shared_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">shared_keys</span><span class="p">)</span><span class="si">}</span><span class="s2"> repeated verification item names identified when loading: </span><span class="si">{</span><span class="n">shared_keys</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lib_name</span><span class="p">,</span> <span class="n">lib_content</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib_items_json_path</span><span class="p">[</span><span class="n">lib_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">if</span> <span class="n">lib_name</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">python_path</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">lib_name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">python_path</span> <span class="o">=</span> <span class="s2">&quot;Not Found&quot;</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Python class file of loaded library item </span><span class="si">{</span><span class="n">lib_name</span><span class="si">}</span><span class="s2"> Not Found in the library&quot;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib_items_python_path</span><span class="p">[</span><span class="n">lib_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">python_path</span>

<div class="viewcode-block" id="VerificationLibrary.get_library_item"><a class="viewcode-back" href="../../Code%20Documentation.html#api.verification_library.VerificationLibrary.get_library_item">[docs]</a>    <span class="k">def</span> <span class="nf">get_library_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the json definition and meta information of a specific library item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item_name (str): Verification item name to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: Library item information with four specific keys:</span>
<span class="sd">                - `library_item_name`: unique str name of the library item.</span>
<span class="sd">                - `library_json`: library item json definition in the library json file.</span>
<span class="sd">                - `library_json_path`: path of the library json file that contains this library item.</span>
<span class="sd">                - `library_python_path`: path of the python file that contains the python implementation of this library item.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">item_name</span> <span class="o">=</span> <span class="n">item_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item_name</span><span class="si">}</span><span class="s2"> is not in loaded library items.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">item_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;library_item_name&quot;</span><span class="p">:</span> <span class="n">item_name</span><span class="p">,</span>
            <span class="s2">&quot;library_definition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span><span class="n">item_name</span><span class="p">],</span>
            <span class="s2">&quot;library_json_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items_json_path</span><span class="p">[</span><span class="n">item_name</span><span class="p">],</span>
            <span class="s2">&quot;library_python_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items_python_path</span><span class="p">[</span><span class="n">item_name</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">item_dict</span></div>

<div class="viewcode-block" id="VerificationLibrary.validate_library"><a class="viewcode-back" href="../../Code%20Documentation.html#api.verification_library.VerificationLibrary.validate_library">[docs]</a>    <span class="k">def</span> <span class="nf">validate_library</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the validity of library items definition. This validity check includes checking the completeness of json specification (against library json schema) and Python verification class definition (against library class interface) and the match between the json and python implementation.</span>

<span class="sd">        Args:</span>
<span class="sd">            items: list of str, default []. Library items to validate. `items` must be filled with valid verification item(s). If not, an error occurs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict that contains validity information of library items.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check `items` type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;items needs to be list. It cannot be a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># check if `items` is an empty list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;items is an empty list. Please provide with verification item names.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">validity_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">validity_info</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># verify the library.json file</span>
            <span class="k">for</span> <span class="n">lib_key</span> <span class="ow">in</span> <span class="n">library_schema</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># check if lib keys exist. &quot;description_detail&quot; key is optional</span>
                <span class="k">if</span> <span class="n">lib_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;description_detail&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span>
                    <span class="n">item</span>
                <span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lib_key</span><span class="p">):</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lib_key</span><span class="si">}</span><span class="s2"> doesn&#39;t exist. Please make sure to have </span><span class="si">{</span><span class="n">lib_key</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># check if key is in the correct type</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">lib_key</span><span class="p">],</span> <span class="n">library_schema</span><span class="p">[</span><span class="n">lib_key</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;The type of `</span><span class="si">{</span><span class="n">lib_key</span><span class="si">}</span><span class="s2">` key needs to be </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">library_schema</span><span class="p">[</span><span class="n">lib_key</span><span class="p">])</span><span class="si">}</span><span class="s2">. It cannot be a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">lib_key</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">validity_info</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">lib_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">lib_key</span><span class="p">]</span>
                        <span class="p">)</span>

                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="c1"># if `description_detail` key doesn&#39;t exist, output a warning.</span>
                    <span class="n">validity_info</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">lib_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lib_key</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>

            <span class="c1"># check if datapoints in library file and class are identical</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s2">&quot;description_datapoints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="o">!=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">points</span>
            <span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;s points in the library file and class implementation are not identical.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validity_info</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s2">&quot;datapoints_match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">validity_info</span></div>

<div class="viewcode-block" id="VerificationLibrary.get_library_items"><a class="viewcode-back" href="../../Code%20Documentation.html#api.verification_library.VerificationLibrary.get_library_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_library_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the json definition and meta information of a list of specific library items.</span>

<span class="sd">        Args:</span>
<span class="sd">            items:  list of str, default []. Library items to get. By default, get all library items loaded at instantiation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of `Dict` with four specific keys:</span>
<span class="sd">                - `library_item_name`: unique str name of the library item.</span>
<span class="sd">                - `library_json`: library item json definition in the library json file.</span>
<span class="sd">                - `library_json_path`: path of the library json file that contains this library item.</span>
<span class="sd">                - `library_python_path`: path of the python file that contains the python implementation of this library item.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check `items` arg type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;items&#39; type must be List. It can&#39;t be </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># cause an error when `items` arg is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;items&#39; arg is empty. Please provide with verification item(s).&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># get each lib item&#39;s summary info</span>
        <span class="n">item_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_library_item</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">item_list</span></div>

<div class="viewcode-block" id="VerificationLibrary.get_applicable_library_items_by_datapoints"><a class="viewcode-back" href="../../Code%20Documentation.html#api.verification_library.VerificationLibrary.get_applicable_library_items_by_datapoints">[docs]</a>    <span class="k">def</span> <span class="nf">get_applicable_library_items_by_datapoints</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">datapoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Based on provided datapoints lists, identify potentially applicable library items from all loaded items. Use this function with caution as it 1) requires aligned data points naming across all library items; 2) does not check the topological relationships between datapoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            datapoints: list of str datapoints names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict with keys being the library item names and values being the required datapoints for the corresponding keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check `datapoints` type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datapoints</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;datapoints&#39; type must be List. It can&#39;t be </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">datapoints</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># check if `datapoints` is an empty list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">datapoints</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`datapoints&#39; is an empty list. Please provide with datapoint names.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># check the type of elements in `datapoints`</span>
        <span class="k">for</span> <span class="n">datapoint</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datapoint</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;element&#39;s type in the datapoints argument must be str. It can&#39;t be </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">datapoint</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># check if applicable lib(s) exists with the datapoints arg</span>
        <span class="n">applicable_lib_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">lib_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">required_lib_datapoints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="p">[</span><span class="n">lib_item</span><span class="p">][</span><span class="s2">&quot;description_datapoints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_lib_datapoints</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">datapoints</span><span class="p">)):</span>
                <span class="n">applicable_lib_dict</span><span class="p">[</span><span class="n">lib_item</span><span class="p">]</span> <span class="o">=</span> <span class="n">required_lib_datapoints</span>

        <span class="k">return</span> <span class="n">applicable_lib_dict</span></div>

<div class="viewcode-block" id="VerificationLibrary.get_required_datapoints_by_library_items"><a class="viewcode-back" href="../../Code%20Documentation.html#api.verification_library.VerificationLibrary.get_required_datapoints_by_library_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_required_datapoints_by_library_items</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">datapoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Summarize datapoints that need to be used to support specified library items. Use this function with caution as it 1) requires aligned data points naming across all library items; 2) does not check the topological relationships between datapoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            items: list of str, default []. Library items to summarize datapoints from. By default, summarize all library items loaded at instantiation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict with keys being the datapoint name and values being a sub Dict with the following keys:</span>
<span class="sd">                - number_of_items_using_this_datapoint: int, number of library items that use this datapoint.</span>
<span class="sd">                - library_items_list: List, of library item names that use this datapoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datapoints</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The `datapoints` argument type must be List, but </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">datapoints</span><span class="p">)</span><span class="si">}</span><span class="s2"> type is provided.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># check if `datapoints` is an empty list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">datapoints</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`datapoints&#39; is an empty list. Please provide with datapoint names.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">req_datapionts_by_lib_items</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">datapoint</span> <span class="ow">in</span> <span class="n">datapoints</span><span class="p">:</span>
            <span class="n">req_datapionts_by_lib_items</span><span class="p">[</span><span class="n">datapoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_items_using_this_datapoint&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;library_items_list&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">datapoint</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;description_datapoints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">req_datapoint_dict</span> <span class="o">=</span> <span class="n">req_datapionts_by_lib_items</span><span class="p">[</span><span class="n">datapoint</span><span class="p">]</span>
                    <span class="n">req_datapoint_dict</span><span class="p">[</span><span class="s2">&quot;number_of_items_using_this_datapoint&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">req_datapoint_dict</span><span class="p">[</span><span class="s2">&quot;library_items_list&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">req_datapionts_by_lib_items</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Pacific Northwest National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>